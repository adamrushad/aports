# Contributor: AdamRushad <adamrushad@adamrushad.com>
# Maintainer: AdamRushad <adamrushad@adamrushad.com>
pkgname=modsecurity
pkgver=3.0.3
pkgrel=0
pkgdesc="ModSecurity WAF engine"
url="https://modsecurity.org"
arch="all"
license="Apache-2.0"
depends=""
makedepends="libxml2-dev pcre-dev linux-headers flex-dev yajl-dev geoip-dev curl-dev valgrind"
install=""
# ModSecurity does not build documentation automatically. Seems to be a bug upstream. Both perl and doxygen
#  will be required for generating documentation once it is fixed/implemented.
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/SpiderLabs/ModSecurity/releases/download/v$pkgver/$pkgname-v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-v$pkgver"

build() {
	cd "$builddir"
	./configure --prefix=/usr --enable-valgrind
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="c75f70cee27c90b7a18d13c80ce7172c3eee1a68a2e07806cccc92dd20bdb27cd61f2b98629e6231a9d860a751bd3e8a72a013b0061738c05e06b4b234190592  modsecurity-3.0.3.tar.gz"
